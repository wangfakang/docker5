{"name":"Docker5","tagline":"docker container startup method of multiple service ","body":"`关于docker启动容器的时候如何同时执行多个任务：`    \r\n　　　从docker的官方文档来看CMD和ENTRYPOINT好像多一次只可以执行一条命令，但是可以给多个参数．   \r\n      那现在有个需求就是我要在启动容器的时候启动多个任务该如何做恩：\r\n      \r\n         方案１．使用shell脚本，把自己要启动的多个任务写在脚本中，然后ENTRYPOINT [\"/docker-entrypoint.sh\"]　   \r\n         方案２．使用 supervisor,他是linux下的一个进程管理工具．使用方法如下：     \r\n\r\n下面方法摘自[docker神书教程](https://yeasy.gitbooks.io/docker_practice/content/cases/supervisor.html)\r\n\r\n配置  \r\n===\r\n\r\n首先创建一个 Dockerfile，内容和各部分的解释如下。　\r\n``` docker\r\nFROM ubuntu:13.04\r\nMAINTAINER examples@docker.com\r\nRUN echo \"deb http://archive.ubuntu.com/ubuntu precise main universe\" > /etc/apt/sources.list\r\nRUN apt-get update\r\nRUN apt-get upgrade -y\r\n\r\n安装 ssh、apache 和 supervisor\r\n\r\nRUN apt-get install -y --force-yes  perl-base=5.14.2-6ubuntu2\r\nRUN apt-get install -y apache2.2-common\r\nRUN apt-get install -y openssh-server apache2 supervisor\r\nRUN mkdir -p /var/run/sshd\r\nRUN mkdir -p /var/log/supervisor\r\n\r\n这里安装 3 个软件，还创建了 2 个 ssh 和 supervisor 服务正常运行所需要的目录。\r\n\r\nCOPY supervisord.conf /etc/supervisor/conf.d/supervisord.conf\r\n\r\n添加 supervisord 的配置文件，并复制配置文件到对应目录下面。\r\n\r\nEXPOSE 22 80\r\nCMD [\"/usr/bin/supervisord\"]\r\n```\r\n\r\n这里我们映射了 22 和 80 端口，使用 supervisord 的可执行路径启动服务。\r\nsupervisor配置文件内容\r\n=====\r\n```docker\r\n[supervisord]\r\nnodaemon=true\r\n[program:sshd]\r\ncommand=/usr/sbin/sshd -D\r\n\r\n[program:apache2]\r\ncommand=/bin/bash -c \"source /etc/apache2/envvars && exec /usr/sbin/apache2 -DFOREGROUND\"\r\n```\r\n配置文件包含目录和进程，第一段 supervsord 配置软件本身，使用 nodaemon 参数来运行。第二段包含要控制的 2 个服务。\r\n每一段包含一个服务的目录和启动这个服务的命令。\r\n使用方法\r\n====\r\n创建镜像。\r\n\r\n$ sudo docker build -t test/supervisord .\r\n\r\n启动 supervisor 容器。\r\n\r\n$ sudo docker run -p 22 -p 80 -t -i test/supervisord\r\n```\r\n2013-11-25 18:53:22,312 CRIT Supervisor running as root (no user in config file)\r\n2013-11-25 18:53:22,312 WARN Included extra file \"/etc/supervisor/conf.d/supervisord.conf\" during parsing\r\n2013-11-25 18:53:22,342 INFO supervisord started with pid 1\r\n2013-11-25 18:53:23,346 INFO spawned: 'sshd' with pid 6\r\n2013-11-25 18:53:23,349 INFO spawned: 'apache2' with pid 7\r\n```\r\n使用 docker run 来启动我们创建的容器。使用多个 -p 来映射多个端口，这样我们就能同时访问 ssh 和 apache 服务了。\r\n\r\n可以使用这个方法创建一个只有 ssh 服务的基础镜像，之后创建镜像可以使用这个镜像为基础来创建\r\n\r\n\r\n欢迎一起交流学习 \r\n====\r\n \r\n在使用中有任何问题，欢迎反馈给我，可以用以下联系方式跟我交流\r\n\r\n* 邮件(1031379296#qq.com, 把#换成@)\r\n* QQ: 1031379296\r\n* weibo: [@王发康](http://weibo.com/u/2786211992/home)\r\n\r\n\r\nThx\r\n====\r\n\r\n* chunshengsterATgmail.com\r\n\r\n\r\nAuthor\r\n====\r\n* Linux\\nginx\\golang\\c\\c++爱好者\r\n* 欢迎一起交流  一起学习# \r\n* Others say good and Others good\r\n\r\n\r\n","google":"docker supervisor  container startup method of multiple service ","note":"Don't delete this file! It's used internally to help with page regeneration."}